(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[38],{

/***/ "./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/stylus-loader/index.js!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--1-oneOf-1-2!./node_modules/stylus-loader!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */
/***/ (function(module, exports, __webpack_require__) {

// Imports
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../../../../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
exports = ___CSS_LOADER_API_IMPORT___(false);
// Module
exports.push([module.i, ".hveuntkp>.controller[data-v-78de78e8],.hveuntkp>.menu[data-v-78de78e8]{position:fixed;z-index:1;padding:16px;background:var(--face);color:var(--text)}.hveuntkp>.controller>section[data-v-78de78e8],.hveuntkp>.menu>section[data-v-78de78e8]{padding:16px 0}.hveuntkp>.controller>section[data-v-78de78e8]:first-child,.hveuntkp>.menu>section[data-v-78de78e8]:first-child{padding-top:0}.hveuntkp>.controller>section[data-v-78de78e8]:last-child,.hveuntkp>.menu>section[data-v-78de78e8]:last-child{padding-bottom:0}.hveuntkp>.controller>section[data-v-78de78e8]:not(:last-child),.hveuntkp>.menu>section[data-v-78de78e8]:not(:last-child){border-bottom:1px solid var(--faceDivider)}.hveuntkp>.controller[data-v-78de78e8]{top:16px;left:16px;width:256px}.hveuntkp>.controller>section>.name[data-v-78de78e8]{margin:0}.hveuntkp>.menu[data-v-78de78e8]{top:16px;right:16px;width:256px}", ""]);
// Exports
module.exports = exports;


/***/ }),

/***/ "./node_modules/vue-style-loader/index.js!./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/stylus-loader/index.js!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-style-loader!./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--1-oneOf-1-2!./node_modules/stylus-loader!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true& ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */
/***/ (function(module, exports, __webpack_require__) {

// style-loader: Adds some css to the DOM by adding a <style> tag

// load the styles
var content = __webpack_require__(/*! !../../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../node_modules/postcss-loader/src??ref--1-oneOf-1-2!../../../../../../../node_modules/stylus-loader!../../../../../../../node_modules/vue-loader/lib??vue-loader-options!../../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true& */ "./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/stylus-loader/index.js!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&");
if(typeof content === 'string') content = [[module.i, content, '']];
if(content.locals) module.exports = content.locals;
// add the styles to the DOM
var add = __webpack_require__(/*! ../../../../../../../node_modules/vue-style-loader/lib/addStylesClient.js */ "./node_modules/vue-style-loader/lib/addStylesClient.js").default
var update = add("3c9d29a9", content, false, {});
// Hot Module Replacement
if(false) {}

/***/ }),

/***/ "./src/client/app/common/scripts/room/furnitures.json5":
/*!*************************************************************!*\
  !*** ./src/client/app/common/scripts/room/furnitures.json5 ***!
  \*************************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */
/***/ (function(module, exports) {

module.exports = [{id:'milk',place:'floor'},{id:'bed',place:'floor'},{id:'low-table',place:'floor',props:{color:'color'},color:{Table:'color'}},{id:'desk',place:'floor',props:{color:'color'},color:{Board:'color'}},{id:'chair',place:'floor',props:{color:'color'},color:{Chair:'color'}},{id:'chair2',place:'floor',props:{color1:'color',color2:'color'},color:{Cushion:'color1',Leg:'color2'}},{id:'fan',place:'wall'},{id:'pc',place:'floor'},{id:'plant',place:'floor'},{id:'plant2',place:'floor'},{id:'eraser',place:'floor'},{id:'pencil',place:'floor'},{id:'pudding',place:'floor'},{id:'cardboard-box',place:'floor'},{id:'cardboard-box2',place:'floor'},{id:'cardboard-box3',place:'floor'},{id:'book',place:'floor',props:{color:'color'},color:{Cover:'color'}},{id:'book2',place:'floor'},{id:'piano',place:'floor'},{id:'facial-tissue',place:'floor'},{id:'server',place:'floor'},{id:'moon',place:'floor'},{id:'corkboard',place:'wall'},{id:'mousepad',place:'floor',props:{color:'color'},color:{Pad:'color'}},{id:'monitor',place:'floor',props:{screen:'image'},texture:{Screen:{prop:'screen',uv:{x:0,y:434,width:1024,height:588}}}},{id:'tv',place:'floor',props:{screen:'image'},texture:{Screen:{prop:'screen',uv:{x:0,y:434,width:1024,height:588}}}},{id:'keyboard',place:'floor'},{id:'carpet-stripe',place:'floor',props:{color1:'color',color2:'color'},color:{CarpetAreaA:'color1',CarpetAreaB:'color2'}},{id:'mat',place:'floor',props:{color:'color'},color:{Mat:'color'}},{id:'color-box',place:'floor',props:{color:'color'},color:{main:'color'}},{id:'wall-clock',place:'wall'},{id:'cube',place:'floor',props:{color:'color'},color:{Cube:'color'}},{id:'photoframe',place:'wall',props:{photo:'image',color:'color'},texture:{Photo:{prop:'photo',uv:{x:0,y:342,width:1024,height:683}}},color:{Frame:'color'}},{id:'pinguin',place:'floor',props:{body:'color',belly:'color'},color:{Body:'body',Belly:'belly'}},{id:'rubik-cube',place:'floor'},{id:'poster-h',place:'wall',props:{picture:'image'},texture:{Poster:{prop:'picture',uv:{x:0,y:277,width:1024,height:745}}}},{id:'poster-v',place:'wall',props:{picture:'image'},texture:{Poster:{prop:'picture',uv:{x:0,y:0,width:745,height:1024}}}},{id:'sofa',place:'floor',props:{color:'color'},color:{Sofa:'color'}},{id:'spiral',place:'floor',props:{color:'color'},color:{Step:'color'}},{id:'bin',place:'floor',props:{color:'color'},color:{Bin:'color'}},{id:'cup-noodle',place:'floor'},{id:'holo-display',place:'floor',props:{image:'image'},texture:{Image_Front:{prop:'image',uv:{x:0,y:0,width:1024,height:1024}},Image_Back:{prop:'image',uv:{x:0,y:0,width:1024,height:1024}}}},{id:'energy-drink',place:'floor'}]

/***/ }),

/***/ "./src/client/app/common/views/pages/room/room.vue":
/*!**********************************************************************!*\
  !*** ./src/client/app/common/views/pages/room/room.vue + 10 modules ***!
  \**********************************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/@fortawesome/free-regular-svg-icons/index.es.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/@fortawesome/free-solid-svg-icons/index.es.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/autobind-decorator/lib/esm/index.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/build/three.module.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/controls/OrbitControls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/controls/TransformControls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/loaders/GLTFLoader.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/postprocessing/BloomPass.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/postprocessing/EffectComposer.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/postprocessing/RenderPass.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/postprocessing/ShaderPass.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/three/examples/jsm/shaders/FXAAShader.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/client/app/i18n.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/misc/acct/parse.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/prelude/url.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/uuid/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/vue-loader/lib/runtime/componentNormalizer.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/vue/dist/vue.runtime.esm.js (<- Module uses injected variables (global, setImmediate)) */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);

// CONCATENATED MODULE: ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=template&id=78de78e8&scoped=true&
var roomvue_type_template_id_78de78e8_scoped_true_render = function() {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  return _c("div", { staticClass: "hveuntkp" }, [
    _vm.objectSelected
      ? _c("div", { staticClass: "controller" }, [
          _c(
            "section",
            [
              _c("p", { staticClass: "name" }, [
                _vm._v(_vm._s(_vm.selectedFurnitureName))
              ]),
              _c("x-preview", { ref: "preview" }),
              _vm.selectedFurnitureInfo.props
                ? _vm._l(Object.keys(_vm.selectedFurnitureInfo.props), function(
                    k
                  ) {
                    return _c(
                      "div",
                      { key: k },
                      [
                        _c("p", [_vm._v(_vm._s(k))]),
                        _vm.selectedFurnitureInfo.props[k] === "image"
                          ? [
                              _c(
                                "ui-button",
                                {
                                  on: {
                                    click: function($event) {
                                      return _vm.chooseImage(k)
                                    }
                                  }
                                },
                                [_vm._v(_vm._s(_vm.$t("chooseImage")))]
                              )
                            ]
                          : _vm.selectedFurnitureInfo.props[k] === "color"
                          ? [
                              _c("input", {
                                attrs: { type: "color" },
                                domProps: {
                                  value: _vm.selectedFurnitureProps
                                    ? _vm.selectedFurnitureProps[k]
                                    : null
                                },
                                on: {
                                  change: function($event) {
                                    return _vm.updateColor(k, $event)
                                  }
                                }
                              })
                            ]
                          : _vm._e()
                      ],
                      2
                    )
                  })
                : _vm._e()
            ],
            2
          ),
          _c(
            "section",
            [
              _c(
                "ui-button",
                {
                  attrs: { primary: _vm.isTranslateMode },
                  on: {
                    click: function($event) {
                      return _vm.translate()
                    }
                  }
                },
                [
                  _c("fa", { attrs: { icon: _vm.faArrowsAlt } }),
                  _vm._v(" " + _vm._s(_vm.$t("translate")))
                ],
                1
              ),
              _c(
                "ui-button",
                {
                  attrs: { primary: _vm.isRotateMode },
                  on: {
                    click: function($event) {
                      return _vm.rotate()
                    }
                  }
                },
                [
                  _c("fa", { attrs: { icon: _vm.faUndo } }),
                  _vm._v(" " + _vm._s(_vm.$t("rotate")))
                ],
                1
              ),
              _vm.isTranslateMode || _vm.isRotateMode
                ? _c(
                    "ui-button",
                    {
                      on: {
                        click: function($event) {
                          return _vm.exit()
                        }
                      }
                    },
                    [
                      _c("fa", { attrs: { icon: _vm.faBan } }),
                      _vm._v(" " + _vm._s(_vm.$t("exit")))
                    ],
                    1
                  )
                : _vm._e()
            ],
            1
          ),
          _c(
            "section",
            [
              _c(
                "ui-button",
                {
                  on: {
                    click: function($event) {
                      return _vm.remove()
                    }
                  }
                },
                [
                  _c("fa", { attrs: { icon: _vm.faTrashAlt } }),
                  _vm._v(" " + _vm._s(_vm.$t("remove")))
                ],
                1
              )
            ],
            1
          )
        ])
      : _vm._e(),
    _vm.isMyRoom
      ? _c("div", { staticClass: "menu" }, [
          _c(
            "section",
            [
              _c(
                "ui-button",
                {
                  on: {
                    click: function($event) {
                      return _vm.add()
                    }
                  }
                },
                [
                  _c("fa", { attrs: { icon: _vm.faBoxOpen } }),
                  _vm._v(" " + _vm._s(_vm.$t("add-furniture")))
                ],
                1
              )
            ],
            1
          ),
          _c(
            "section",
            [
              _c(
                "ui-select",
                {
                  attrs: { value: _vm.roomType },
                  on: {
                    input: function($event) {
                      return _vm.updateRoomType($event)
                    }
                  },
                  scopedSlots: _vm._u(
                    [
                      {
                        key: "label",
                        fn: function() {
                          return [_vm._v(_vm._s(_vm.$t("room-type")))]
                        },
                        proxy: true
                      }
                    ],
                    null,
                    false,
                    3739269933
                  )
                },
                [
                  _c("option", { attrs: { value: "default" } }, [
                    _vm._v(_vm._s(_vm.$t("rooms.default")))
                  ]),
                  _c("option", { attrs: { value: "washitsu" } }, [
                    _vm._v(_vm._s(_vm.$t("rooms.washitsu")))
                  ])
                ]
              ),
              _vm.roomType === "default"
                ? _c("label", [
                    _c("span", [_vm._v(_vm._s(_vm.$t("carpet-color")))]),
                    _c("input", {
                      attrs: { type: "color" },
                      domProps: { value: _vm.carpetColor },
                      on: {
                        change: function($event) {
                          return _vm.updateCarpetColor($event)
                        }
                      }
                    })
                  ])
                : _vm._e()
            ],
            1
          ),
          _c(
            "section",
            [
              _c(
                "ui-button",
                {
                  attrs: { primary: _vm.changed },
                  on: {
                    click: function($event) {
                      return _vm.save()
                    }
                  }
                },
                [
                  _c("fa", { attrs: { icon: _vm.faSave } }),
                  _vm._v(" " + _vm._s(_vm.$t("save")))
                ],
                1
              ),
              _c(
                "ui-button",
                {
                  on: {
                    click: function($event) {
                      return _vm.clear()
                    }
                  }
                },
                [
                  _c("fa", { attrs: { icon: _vm.faBroom } }),
                  _vm._v(" " + _vm._s(_vm.$t("clear")))
                ],
                1
              )
            ],
            1
          )
        ])
      : _vm._e()
  ])
}
var staticRenderFns = []
roomvue_type_template_id_78de78e8_scoped_true_render._withStripped = true


// CONCATENATED MODULE: ./src/client/app/common/views/pages/room/room.vue?vue&type=template&id=78de78e8&scoped=true&

// EXTERNAL MODULE: ./node_modules/vue/dist/vue.runtime.esm.js
var vue_runtime_esm = __webpack_require__("./node_modules/vue/dist/vue.runtime.esm.js");

// EXTERNAL MODULE: ./src/client/app/i18n.ts
var i18n = __webpack_require__("./src/client/app/i18n.ts");

// EXTERNAL MODULE: ./node_modules/autobind-decorator/lib/esm/index.js
var esm = __webpack_require__("./node_modules/autobind-decorator/lib/esm/index.js");

// EXTERNAL MODULE: ./node_modules/uuid/index.js
var uuid = __webpack_require__("./node_modules/uuid/index.js");

// EXTERNAL MODULE: ./node_modules/three/build/three.module.js
var three_module = __webpack_require__("./node_modules/three/build/three.module.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/loaders/GLTFLoader.js
var GLTFLoader = __webpack_require__("./node_modules/three/examples/jsm/loaders/GLTFLoader.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/controls/OrbitControls.js
var OrbitControls = __webpack_require__("./node_modules/three/examples/jsm/controls/OrbitControls.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/postprocessing/EffectComposer.js + 1 modules
var EffectComposer = __webpack_require__("./node_modules/three/examples/jsm/postprocessing/EffectComposer.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/postprocessing/RenderPass.js
var RenderPass = __webpack_require__("./node_modules/three/examples/jsm/postprocessing/RenderPass.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/postprocessing/ShaderPass.js
var ShaderPass = __webpack_require__("./node_modules/three/examples/jsm/postprocessing/ShaderPass.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/postprocessing/BloomPass.js + 1 modules
var BloomPass = __webpack_require__("./node_modules/three/examples/jsm/postprocessing/BloomPass.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/shaders/FXAAShader.js
var FXAAShader = __webpack_require__("./node_modules/three/examples/jsm/shaders/FXAAShader.js");

// EXTERNAL MODULE: ./node_modules/three/examples/jsm/controls/TransformControls.js
var TransformControls = __webpack_require__("./node_modules/three/examples/jsm/controls/TransformControls.js");

// EXTERNAL MODULE: ./src/prelude/url.ts
var url = __webpack_require__("./src/prelude/url.ts");

// CONCATENATED MODULE: ./src/client/app/common/scripts/room/room.ts
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};












const furnitureDefs = __webpack_require__(/*! ./furnitures.json5 */ "./src/client/app/common/scripts/room/furnitures.json5");
three_module["ImageUtils"].crossOrigin = '';
/**
 * MisskeyRoom Core Engine
 */
class room_Room {
    constructor(user, isMyRoom, roomInfo, container, options) {
        this.mixers = [];
        this.objects = [];
        this.selectedObject = null;
        this.isTransformMode = false;
        this.roomInfo = roomInfo;
        this.graphicsQuality = options.graphicsQuality;
        this.onChangeSelect = options.onChangeSelect;
        this.clock = new three_module["Clock"](true);
        //#region Init a scene
        this.scene = new three_module["Scene"]();
        const width = window.innerWidth;
        const height = window.innerHeight;
        //#region Init a renderer
        this.renderer = new three_module["WebGLRenderer"]({
            antialias: false,
            stencil: false,
            alpha: false,
            powerPreference: this.graphicsQuality === 'ultra' ? 'high-performance' :
                this.graphicsQuality === 'high' ? 'high-performance' :
                    this.graphicsQuality === 'medium' ? 'default' :
                        this.graphicsQuality === 'low' ? 'low-power' :
                            'low-power' // cheep
        });
        this.renderer.setPixelRatio(window.devicePixelRatio);
        this.renderer.setSize(width, height);
        this.renderer.autoClear = false;
        this.renderer.setClearColor(new three_module["Color"](0x051f2d));
        this.renderer.shadowMap.enabled = this.enableShadow;
        this.renderer.shadowMap.type =
            this.graphicsQuality === 'ultra' ? three_module["PCFSoftShadowMap"] :
                this.graphicsQuality === 'high' ? three_module["PCFSoftShadowMap"] :
                    this.graphicsQuality === 'medium' ? three_module["PCFShadowMap"] :
                        this.graphicsQuality === 'low' ? three_module["BasicShadowMap"] :
                            three_module["BasicShadowMap"]; // cheep
        container.appendChild(this.canvas);
        //#endregion
        //#region Init a camera
        this.camera = options.useOrthographicCamera
            ? new three_module["OrthographicCamera"](width / -2, width / 2, height / 2, height / -2, -10, 10)
            : new three_module["PerspectiveCamera"](45, width / height);
        if (options.useOrthographicCamera) {
            this.camera.position.x = 2;
            this.camera.position.y = 2;
            this.camera.position.z = 2;
            this.camera.zoom = 100;
            this.camera.updateProjectionMatrix();
        }
        else {
            this.camera.position.x = 5;
            this.camera.position.y = 2;
            this.camera.position.z = 5;
        }
        this.scene.add(this.camera);
        //#endregion
        //#region AmbientLight
        const ambientLight = new three_module["AmbientLight"](0xffffff, 1);
        this.scene.add(ambientLight);
        //#endregion
        if (this.graphicsQuality !== 'cheep') {
            //#region Room light
            const roomLight = new three_module["SpotLight"](0xffffff, 0.1);
            roomLight.position.set(0, 8, 0);
            roomLight.castShadow = this.enableShadow;
            roomLight.shadow.bias = -0.0001;
            roomLight.shadow.mapSize.width = this.shadowQuality;
            roomLight.shadow.mapSize.height = this.shadowQuality;
            roomLight.shadow.camera.near = 0.1;
            roomLight.shadow.camera.far = 9;
            roomLight.shadow.camera.fov = 45;
            this.scene.add(roomLight);
            //#endregion
        }
        //#region Out light
        const outLight1 = new three_module["SpotLight"](0xffffff, 0.4);
        outLight1.position.set(9, 3, -2);
        outLight1.castShadow = this.enableShadow;
        outLight1.shadow.bias = -0.001; // アクネ、アーチファクト対策 その代わりピーターパンが発生する可能性がある
        outLight1.shadow.mapSize.width = this.shadowQuality;
        outLight1.shadow.mapSize.height = this.shadowQuality;
        outLight1.shadow.camera.near = 6;
        outLight1.shadow.camera.far = 15;
        outLight1.shadow.camera.fov = 45;
        this.scene.add(outLight1);
        const outLight2 = new three_module["SpotLight"](0xffffff, 0.2);
        outLight2.position.set(-2, 3, 9);
        outLight2.castShadow = false;
        outLight2.shadow.bias = -0.001; // アクネ、アーチファクト対策 その代わりピーターパンが発生する可能性がある
        outLight2.shadow.camera.near = 6;
        outLight2.shadow.camera.far = 15;
        outLight2.shadow.camera.fov = 45;
        this.scene.add(outLight2);
        //#endregion
        //#region Init a controller
        this.controls = new OrbitControls["OrbitControls"](this.camera, this.canvas);
        this.controls.target.set(0, 1, 0);
        this.controls.enableZoom = true;
        this.controls.enablePan = isMyRoom;
        this.controls.minPolarAngle = 0;
        this.controls.maxPolarAngle = Math.PI / 2;
        this.controls.minAzimuthAngle = 0;
        this.controls.maxAzimuthAngle = Math.PI / 2;
        this.controls.enableDamping = true;
        this.controls.dampingFactor = 0.2;
        this.controls.mouseButtons.LEFT = 1;
        this.controls.mouseButtons.MIDDLE = 2;
        this.controls.mouseButtons.RIGHT = 0;
        //#endregion
        //#region POST FXs
        if (!this.usePostFXs) {
            this.composer = null;
        }
        else {
            const renderTarget = new three_module["WebGLRenderTarget"](width, height, {
                minFilter: three_module["LinearFilter"],
                magFilter: three_module["LinearFilter"],
                format: three_module["RGBFormat"],
                stencilBuffer: false,
            });
            const fxaa = new ShaderPass["ShaderPass"](FXAAShader["FXAAShader"]);
            fxaa.uniforms['resolution'].value = new three_module["Vector2"](1 / width, 1 / height);
            fxaa.renderToScreen = true;
            this.composer = new EffectComposer["EffectComposer"](this.renderer, renderTarget);
            this.composer.addPass(new RenderPass["RenderPass"](this.scene, this.camera));
            if (this.graphicsQuality === 'ultra') {
                this.composer.addPass(new BloomPass["BloomPass"](0.25, 30, 128.0, 512));
            }
            this.composer.addPass(fxaa);
        }
        //#endregion
        //#endregion
        //#region Label
        //#region Avatar
        const avatarUrl = `/proxy/?${Object(url["query"])({ url: user.avatarUrl })}`;
        const textureLoader = new three_module["TextureLoader"]();
        textureLoader.crossOrigin = 'anonymous';
        const iconTexture = textureLoader.load(avatarUrl);
        iconTexture.wrapS = three_module["RepeatWrapping"];
        iconTexture.wrapT = three_module["RepeatWrapping"];
        iconTexture.anisotropy = 16;
        const avatarMaterial = new three_module["MeshBasicMaterial"]({
            map: iconTexture,
            side: three_module["DoubleSide"],
            alphaTest: 0.5
        });
        const iconGeometry = new three_module["PlaneGeometry"](1, 1);
        const avatarObject = new three_module["Mesh"](iconGeometry, avatarMaterial);
        avatarObject.position.set(-3, 2.5, 2);
        avatarObject.rotation.y = Math.PI / 2;
        avatarObject.castShadow = false;
        this.scene.add(avatarObject);
        //#endregion
        //#region Username
        const name = user.username;
        new three_module["FontLoader"]().load('/assets/fonts/helvetiker_regular.typeface.json', font => {
            const nameGeometry = new three_module["TextGeometry"](name, {
                size: 0.5,
                height: 0,
                curveSegments: 8,
                font: font,
                bevelThickness: 0,
                bevelSize: 0,
                bevelEnabled: false
            });
            const nameMaterial = new three_module["MeshLambertMaterial"]({
                color: 0xffffff
            });
            const nameObject = new three_module["Mesh"](nameGeometry, nameMaterial);
            nameObject.position.set(-3, 2.25, 1.25);
            nameObject.rotation.y = Math.PI / 2;
            nameObject.castShadow = false;
            this.scene.add(nameObject);
        });
        //#endregion
        //#endregion
        //#region Interaction
        if (isMyRoom) {
            this.furnitureControl = new TransformControls["TransformControls"](this.camera, this.canvas);
            this.scene.add(this.furnitureControl);
            // Hover highlight
            this.canvas.onmousemove = this.onmousemove;
            // Click
            this.canvas.onmousedown = this.onmousedown;
        }
        //#endregion
        //#region Init room
        this.loadRoom();
        //#endregion
        //#region Load furnitures
        for (const furniture of this.furnitures) {
            this.loadFurniture(furniture).then(obj => {
                this.scene.add(obj.scene);
                this.objects.push(obj.scene);
            });
        }
        //#endregion
        // Start render
        if (this.usePostFXs) {
            this.renderWithPostFXs();
        }
        else {
            this.renderWithoutPostFXs();
        }
    }
    get canvas() {
        return this.renderer.domElement;
    }
    get furnitures() {
        return this.roomInfo.furnitures;
    }
    set furnitures(furnitures) {
        this.roomInfo.furnitures = furnitures;
    }
    get enableShadow() {
        return this.graphicsQuality != 'cheep';
    }
    get usePostFXs() {
        return this.graphicsQuality !== 'cheep' && this.graphicsQuality !== 'low';
    }
    get shadowQuality() {
        return (this.graphicsQuality === 'ultra' ? 16384 :
            this.graphicsQuality === 'high' ? 8192 :
                this.graphicsQuality === 'medium' ? 4096 :
                    this.graphicsQuality === 'low' ? 1024 :
                        0); // cheep
    }
    renderWithoutPostFXs() {
        this.renderFrameRequestId =
            window.requestAnimationFrame(this.renderWithoutPostFXs);
        // Update animations
        const clock = this.clock.getDelta();
        for (const mixer of this.mixers) {
            mixer.update(clock);
        }
        this.controls.update();
        this.renderer.render(this.scene, this.camera);
    }
    renderWithPostFXs() {
        this.renderFrameRequestId =
            window.requestAnimationFrame(this.renderWithPostFXs);
        // Update animations
        const clock = this.clock.getDelta();
        for (const mixer of this.mixers) {
            mixer.update(clock);
        }
        this.controls.update();
        this.renderer.clear();
        this.composer.render();
    }
    loadRoom() {
        const type = this.roomInfo.roomType;
        new GLTFLoader["GLTFLoader"]().load(`/assets/room/rooms/${type}/${type}.glb`, gltf => {
            gltf.scene.traverse(child => {
                if (!(child instanceof three_module["Mesh"]))
                    return;
                child.receiveShadow = this.enableShadow;
                child.material = new three_module["MeshLambertMaterial"]({
                    color: child.material.color,
                    map: child.material.map,
                    name: child.material.name,
                });
                // 異方性フィルタリング
                if (child.material.map && this.graphicsQuality !== 'cheep') {
                    child.material.map.minFilter = three_module["LinearMipMapLinearFilter"];
                    child.material.map.magFilter = three_module["LinearMipMapLinearFilter"];
                    child.material.map.anisotropy = 8;
                }
            });
            gltf.scene.position.set(0, 0, 0);
            this.scene.add(gltf.scene);
            this.roomObj = gltf.scene;
            if (this.roomInfo.roomType === 'default') {
                this.applyCarpetColor();
            }
        });
    }
    loadFurniture(furniture) {
        const def = furnitureDefs.find(d => d.id === furniture.type);
        return new Promise((res, rej) => {
            const loader = new GLTFLoader["GLTFLoader"]();
            loader.load(`/assets/room/furnitures/${furniture.type}/${furniture.type}.glb`, gltf => {
                const model = gltf.scene;
                // Load animation
                if (gltf.animations.length > 0) {
                    const mixer = new three_module["AnimationMixer"](model);
                    this.mixers.push(mixer);
                    for (const clip of gltf.animations) {
                        mixer.clipAction(clip).play();
                    }
                }
                model.name = furniture.id;
                model.position.x = furniture.position.x;
                model.position.y = furniture.position.y;
                model.position.z = furniture.position.z;
                model.rotation.x = furniture.rotation.x;
                model.rotation.y = furniture.rotation.y;
                model.rotation.z = furniture.rotation.z;
                model.traverse(child => {
                    if (!(child instanceof three_module["Mesh"]))
                        return;
                    child.castShadow = this.enableShadow;
                    child.receiveShadow = this.enableShadow;
                    child.material.metalness = 0;
                    // 異方性フィルタリング
                    if (child.material.map && this.graphicsQuality !== 'cheep') {
                        child.material.map.minFilter = three_module["LinearMipMapLinearFilter"];
                        child.material.map.magFilter = three_module["LinearMipMapLinearFilter"];
                        child.material.map.anisotropy = 8;
                    }
                });
                if (def.color) { // カスタムカラー
                    this.applyCustomColor(model);
                }
                if (def.texture) { // カスタムテクスチャ
                    this.applyCustomTexture(model);
                }
                res(gltf);
            }, null, rej);
        });
    }
    applyCarpetColor() {
        this.roomObj.traverse(child => {
            if (!(child instanceof three_module["Mesh"]))
                return;
            if (child.material &&
                child.material.name &&
                child.material.name === 'Carpet') {
                const colorHex = parseInt(this.roomInfo.carpetColor.substr(1), 16);
                child.material.color.setHex(colorHex);
            }
        });
    }
    applyCustomColor(model) {
        const furniture = this.furnitures.find(furniture => furniture.id === model.name);
        const def = furnitureDefs.find(d => d.id === furniture.type);
        if (def.color == null)
            return;
        model.traverse(child => {
            if (!(child instanceof three_module["Mesh"]))
                return;
            for (const t of Object.keys(def.color)) {
                if (!child.material ||
                    !child.material.name ||
                    child.material.name !== t)
                    continue;
                const prop = def.color[t];
                const val = furniture.props ? furniture.props[prop] : undefined;
                if (val == null)
                    continue;
                const colorHex = parseInt(val.substr(1), 16);
                child.material.color.setHex(colorHex);
            }
        });
    }
    applyCustomTexture(model) {
        const furniture = this.furnitures.find(furniture => furniture.id === model.name);
        const def = furnitureDefs.find(d => d.id === furniture.type);
        if (def.texture == null)
            return;
        model.traverse(child => {
            if (!(child instanceof three_module["Mesh"]))
                return;
            for (const t of Object.keys(def.texture)) {
                if (child.name !== t)
                    continue;
                const prop = def.texture[t].prop;
                const val = furniture.props ? furniture.props[prop] : undefined;
                if (val == null)
                    continue;
                const canvas = document.createElement('canvas');
                canvas.height = 1024;
                canvas.width = 1024;
                child.material = new three_module["MeshLambertMaterial"]({
                    emissive: 0x111111,
                    side: three_module["DoubleSide"],
                    alphaTest: 0.5,
                });
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    const uvInfo = def.texture[t].uv;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, img.width, img.height, uvInfo.x, uvInfo.y, uvInfo.width, uvInfo.height);
                    const texture = new three_module["Texture"](canvas);
                    texture.wrapS = three_module["RepeatWrapping"];
                    texture.wrapT = three_module["RepeatWrapping"];
                    texture.anisotropy = 16;
                    texture.flipY = false;
                    child.material.map = texture;
                    child.material.needsUpdate = true;
                    child.material.map.needsUpdate = true;
                };
                img.src = val;
            }
        });
    }
    onmousemove(ev) {
        if (this.isTransformMode)
            return;
        const rect = ev.target.getBoundingClientRect();
        const x = (((ev.clientX * window.devicePixelRatio) - rect.left) / this.canvas.width) * 2 - 1;
        const y = -(((ev.clientY * window.devicePixelRatio) - rect.top) / this.canvas.height) * 2 + 1;
        const pos = new three_module["Vector2"](x, y);
        this.camera.updateMatrixWorld();
        const raycaster = new three_module["Raycaster"]();
        raycaster.setFromCamera(pos, this.camera);
        const intersects = raycaster.intersectObjects(this.objects, true);
        for (const object of this.objects) {
            if (this.isSelectedObject(object))
                continue;
            object.traverse(child => {
                if (child instanceof three_module["Mesh"]) {
                    child.material.emissive.setHex(0x000000);
                }
            });
        }
        if (intersects.length > 0) {
            const intersected = this.getRoot(intersects[0].object);
            if (this.isSelectedObject(intersected))
                return;
            intersected.traverse(child => {
                if (child instanceof three_module["Mesh"]) {
                    child.material.emissive.setHex(0x191919);
                }
            });
        }
    }
    onmousedown(ev) {
        if (this.isTransformMode)
            return;
        if (ev.target !== this.canvas || ev.button !== 0)
            return;
        const rect = ev.target.getBoundingClientRect();
        const x = (((ev.clientX * window.devicePixelRatio) - rect.left) / this.canvas.width) * 2 - 1;
        const y = -(((ev.clientY * window.devicePixelRatio) - rect.top) / this.canvas.height) * 2 + 1;
        const pos = new three_module["Vector2"](x, y);
        this.camera.updateMatrixWorld();
        const raycaster = new three_module["Raycaster"]();
        raycaster.setFromCamera(pos, this.camera);
        const intersects = raycaster.intersectObjects(this.objects, true);
        for (const object of this.objects) {
            object.traverse(child => {
                if (child instanceof three_module["Mesh"]) {
                    child.material.emissive.setHex(0x000000);
                }
            });
        }
        if (intersects.length > 0) {
            const selectedObj = this.getRoot(intersects[0].object);
            this.selectFurniture(selectedObj);
        }
        else {
            this.selectedObject = null;
            this.onChangeSelect(null);
        }
    }
    getRoot(obj) {
        let found = false;
        let x = obj.parent;
        while (!found) {
            if (x.parent.parent == null) {
                found = true;
            }
            else {
                x = x.parent;
            }
        }
        return x;
    }
    isSelectedObject(obj) {
        if (this.selectedObject == null) {
            return false;
        }
        else {
            return obj.name === this.selectedObject.name;
        }
    }
    selectFurniture(obj) {
        this.selectedObject = obj;
        this.onChangeSelect(obj);
        obj.traverse(child => {
            if (child instanceof three_module["Mesh"]) {
                child.material.emissive.setHex(0xff0000);
            }
        });
    }
    /**
     * 家具の移動/回転モードにします
     * @param type 移動か回転か
     */
    enterTransformMode(type) {
        this.isTransformMode = true;
        this.furnitureControl.setMode(type);
        this.furnitureControl.attach(this.selectedObject);
    }
    /**
     * 家具の移動/回転モードを終了します
     */
    exitTransformMode() {
        this.isTransformMode = false;
        this.furnitureControl.detach();
    }
    /**
     * 家具プロパティを更新します
     * @param key プロパティ名
     * @param value 値
     */
    updateProp(key, value) {
        const furniture = this.furnitures.find(furniture => furniture.id === this.selectedObject.name);
        if (furniture.props == null)
            furniture.props = {};
        furniture.props[key] = value;
        this.applyCustomColor(this.selectedObject);
        this.applyCustomTexture(this.selectedObject);
    }
    /**
     * 部屋に家具を追加します
     * @param type 家具の種類
     */
    addFurniture(type) {
        const furniture = {
            id: Object(uuid["v4"])(),
            type: type,
            position: {
                x: 0,
                y: 0,
                z: 0,
            },
            rotation: {
                x: 0,
                y: 0,
                z: 0,
            },
        };
        this.furnitures.push(furniture);
        this.loadFurniture(furniture).then(obj => {
            this.scene.add(obj.scene);
            this.objects.push(obj.scene);
        });
    }
    /**
     * 現在選択されている家具を部屋から削除します
     */
    removeFurniture() {
        this.exitTransformMode();
        const obj = this.selectedObject;
        this.scene.remove(obj);
        this.objects = this.objects.filter(object => object.name !== obj.name);
        this.furnitures = this.furnitures.filter(furniture => furniture.id !== obj.name);
        this.selectedObject = null;
        this.onChangeSelect(null);
    }
    /**
     * 全ての家具を部屋から削除します
     */
    removeAllFurnitures() {
        this.exitTransformMode();
        for (const obj of this.objects) {
            this.scene.remove(obj);
        }
        this.objects = [];
        this.furnitures = [];
        this.selectedObject = null;
        this.onChangeSelect(null);
    }
    /**
     * 部屋の床の色を変更します
     * @param color 色
     */
    updateCarpetColor(color) {
        this.roomInfo.carpetColor = color;
        this.applyCarpetColor();
    }
    /**
     * 部屋の種類を変更します
     * @param type 種類
     */
    changeRoomType(type) {
        this.roomInfo.roomType = type;
        this.scene.remove(this.roomObj);
        this.loadRoom();
    }
    /**
     * 部屋データを取得します
     */
    getRoomInfo() {
        for (const obj of this.objects) {
            const furniture = this.furnitures.find(f => f.id === obj.name);
            furniture.position.x = obj.position.x;
            furniture.position.y = obj.position.y;
            furniture.position.z = obj.position.z;
            furniture.rotation.x = obj.rotation.x;
            furniture.rotation.y = obj.rotation.y;
            furniture.rotation.z = obj.rotation.z;
        }
        return this.roomInfo;
    }
    /**
     * 選択されている家具を取得します
     */
    getSelectedObject() {
        return this.selectedObject;
    }
    findFurnitureById(id) {
        return this.furnitures.find(furniture => furniture.id === id);
    }
    /**
     * レンダリングを終了します
     */
    destroy() {
        // Stop render loop
        window.cancelAnimationFrame(this.renderFrameRequestId);
        this.controls.dispose();
        this.scene.dispose();
    }
}
__decorate([
    esm["default"]
], room_Room.prototype, "renderWithoutPostFXs", null);
__decorate([
    esm["default"]
], room_Room.prototype, "renderWithPostFXs", null);
__decorate([
    esm["default"]
], room_Room.prototype, "loadRoom", null);
__decorate([
    esm["default"]
], room_Room.prototype, "loadFurniture", null);
__decorate([
    esm["default"]
], room_Room.prototype, "applyCarpetColor", null);
__decorate([
    esm["default"]
], room_Room.prototype, "applyCustomColor", null);
__decorate([
    esm["default"]
], room_Room.prototype, "applyCustomTexture", null);
__decorate([
    esm["default"]
], room_Room.prototype, "onmousemove", null);
__decorate([
    esm["default"]
], room_Room.prototype, "onmousedown", null);
__decorate([
    esm["default"]
], room_Room.prototype, "getRoot", null);
__decorate([
    esm["default"]
], room_Room.prototype, "isSelectedObject", null);
__decorate([
    esm["default"]
], room_Room.prototype, "selectFurniture", null);
__decorate([
    esm["default"]
], room_Room.prototype, "enterTransformMode", null);
__decorate([
    esm["default"]
], room_Room.prototype, "exitTransformMode", null);
__decorate([
    esm["default"]
], room_Room.prototype, "updateProp", null);
__decorate([
    esm["default"]
], room_Room.prototype, "addFurniture", null);
__decorate([
    esm["default"]
], room_Room.prototype, "removeFurniture", null);
__decorate([
    esm["default"]
], room_Room.prototype, "removeAllFurnitures", null);
__decorate([
    esm["default"]
], room_Room.prototype, "updateCarpetColor", null);
__decorate([
    esm["default"]
], room_Room.prototype, "changeRoomType", null);
__decorate([
    esm["default"]
], room_Room.prototype, "getRoomInfo", null);
__decorate([
    esm["default"]
], room_Room.prototype, "getSelectedObject", null);
__decorate([
    esm["default"]
], room_Room.prototype, "findFurnitureById", null);
__decorate([
    esm["default"]
], room_Room.prototype, "destroy", null);

// EXTERNAL MODULE: ./src/misc/acct/parse.ts
var parse = __webpack_require__("./src/misc/acct/parse.ts");

// CONCATENATED MODULE: ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/preview.vue?vue&type=template&id=4cbb674b&
var previewvue_type_template_id_4cbb674b_render = function() {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  return _c("canvas", { attrs: { width: "224", height: "128" } })
}
var previewvue_type_template_id_4cbb674b_staticRenderFns = []
previewvue_type_template_id_4cbb674b_render._withStripped = true


// CONCATENATED MODULE: ./src/client/app/common/views/pages/room/preview.vue?vue&type=template&id=4cbb674b&

// CONCATENATED MODULE: ./node_modules/ts-loader??ref--5-0!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/preview.vue?vue&type=script&lang=ts&


/* harmony default export */ var previewvue_type_script_lang_ts_ = (vue_runtime_esm["default"].extend({
    data() {
        return {
            selected: null,
            objectHeight: 0,
            orbitRadius: 5
        };
    },
    mounted() {
        const canvas = this.$el;
        const width = canvas.width;
        const height = canvas.height;
        const scene = new three_module["Scene"]();
        const renderer = new three_module["WebGLRenderer"]({
            canvas: canvas,
            antialias: true,
            alpha: false
        });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(width, height);
        renderer.setClearColor(0x000000);
        renderer.autoClear = false;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.cullFace = three_module["CullFaceBack"];
        const camera = new three_module["PerspectiveCamera"](75, width / height, 0.1, 100);
        camera.zoom = 10;
        camera.position.x = 0;
        camera.position.y = 2;
        camera.position.z = 0;
        camera.updateProjectionMatrix();
        scene.add(camera);
        const ambientLight = new three_module["AmbientLight"](0xffffff, 1);
        ambientLight.castShadow = false;
        scene.add(ambientLight);
        const light = new three_module["PointLight"](0xffffff, 1, 100);
        light.position.set(3, 3, 3);
        scene.add(light);
        const grid = new three_module["GridHelper"](5, 16, 0x444444, 0x222222);
        scene.add(grid);
        const render = () => {
            const timer = Date.now() * 0.0004;
            requestAnimationFrame(render);
            camera.position.y = Math.sin(Math.PI / 6) * this.orbitRadius; // Math.PI / 6 => 30deg
            camera.position.z = Math.cos(timer) * this.orbitRadius;
            camera.position.x = Math.sin(timer) * this.orbitRadius;
            camera.lookAt(new three_module["Vector3"](0, this.objectHeight / 2, 0));
            renderer.render(scene, camera);
        };
        this.selected = selected => {
            const obj = selected.clone();
            // Remove current object
            const current = scene.getObjectByName('obj');
            if (current != null) {
                scene.remove(current);
            }
            // Add new object
            obj.name = 'obj';
            obj.position.x = 0;
            obj.position.y = 0;
            obj.position.z = 0;
            obj.rotation.x = 0;
            obj.rotation.y = 0;
            obj.rotation.z = 0;
            obj.traverse(child => {
                if (child instanceof three_module["Mesh"]) {
                    child.material = child.material.clone();
                    return child.material.emissive.setHex(0x000000);
                }
            });
            const objectBoundingBox = new three_module["Box3"]().setFromObject(obj);
            this.objectHeight = objectBoundingBox.max.y - objectBoundingBox.min.y;
            const objectWidth = objectBoundingBox.max.x - objectBoundingBox.min.x;
            const objectDepth = objectBoundingBox.max.z - objectBoundingBox.min.z;
            const horizontal = Math.hypot(objectWidth, objectDepth) / camera.aspect;
            this.orbitRadius = Math.max(horizontal, this.objectHeight) * camera.zoom * 0.625 / Math.tan(camera.fov * 0.5 * (Math.PI / 180));
            scene.add(obj);
        };
        render();
    },
}));

// CONCATENATED MODULE: ./src/client/app/common/views/pages/room/preview.vue?vue&type=script&lang=ts&
 /* harmony default export */ var room_previewvue_type_script_lang_ts_ = (previewvue_type_script_lang_ts_); 
// EXTERNAL MODULE: ./node_modules/vue-loader/lib/runtime/componentNormalizer.js
var componentNormalizer = __webpack_require__("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");

// CONCATENATED MODULE: ./src/client/app/common/views/pages/room/preview.vue





/* normalize component */

var component = Object(componentNormalizer["default"])(
  room_previewvue_type_script_lang_ts_,
  previewvue_type_template_id_4cbb674b_render,
  previewvue_type_template_id_4cbb674b_staticRenderFns,
  false,
  null,
  null,
  null
  
)

/* hot reload */
if (false) { var api; }
component.options.__file = "src/client/app/common/views/pages/room/preview.vue"
/* harmony default export */ var preview = (component.exports);
// EXTERNAL MODULE: ./node_modules/@fortawesome/free-solid-svg-icons/index.es.js
var index_es = __webpack_require__("./node_modules/@fortawesome/free-solid-svg-icons/index.es.js");

// EXTERNAL MODULE: ./node_modules/@fortawesome/free-regular-svg-icons/index.es.js
var free_regular_svg_icons_index_es = __webpack_require__("./node_modules/@fortawesome/free-regular-svg-icons/index.es.js");

// CONCATENATED MODULE: ./node_modules/ts-loader??ref--5-0!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=script&lang=ts&





const storeItems = __webpack_require__(/*! ../../../scripts/room/furnitures.json5 */ "./src/client/app/common/scripts/room/furnitures.json5");



let room;
/* harmony default export */ var roomvue_type_script_lang_ts_ = (vue_runtime_esm["default"].extend({
    i18n: Object(i18n["default"])('room'),
    components: {
        XPreview: preview
    },
    props: {
        acct: {
            type: String,
            required: true
        },
    },
    data() {
        return {
            objectSelected: false,
            selectedFurnitureName: null,
            selectedFurnitureInfo: null,
            selectedFurnitureProps: null,
            roomType: null,
            carpetColor: null,
            isTranslateMode: false,
            isRotateMode: false,
            isMyRoom: false,
            changed: false,
            faBoxOpen: index_es["faBoxOpen"], faSave: free_regular_svg_icons_index_es["faSave"], faTrashAlt: free_regular_svg_icons_index_es["faTrashAlt"], faUndo: index_es["faUndo"], faArrowsAlt: index_es["faArrowsAlt"], faBan: index_es["faBan"], faBroom: index_es["faBroom"],
        };
    },
    async mounted() {
        window.addEventListener('beforeunload', this.beforeunload);
        const user = await this.$root.api('users/show', Object.assign({}, Object(parse["default"])(this.acct)));
        this.isMyRoom = this.$store.getters.isSignedIn && this.$store.state.i.id === user.id;
        const roomInfo = await this.$root.api('room/show', {
            userId: user.id
        });
        this.roomType = roomInfo.roomType;
        this.carpetColor = roomInfo.carpetColor;
        room = new room_Room(user, this.isMyRoom, roomInfo, this.$el, {
            graphicsQuality: this.$store.state.device.roomGraphicsQuality,
            onChangeSelect: obj => {
                this.objectSelected = obj != null;
                if (obj) {
                    const f = room.findFurnitureById(obj.name);
                    this.selectedFurnitureName = this.$t('furnitures.' + f.type);
                    this.selectedFurnitureInfo = storeItems.find(x => x.id === f.type);
                    this.selectedFurnitureProps = f.props
                        ? JSON.parse(JSON.stringify(f.props)) // Disable reactivity
                        : null;
                    this.$nextTick(() => {
                        this.$refs.preview.selected(obj);
                    });
                }
            },
            useOrthographicCamera: this.$store.state.device.roomUseOrthographicCamera
        });
    },
    beforeRouteLeave(to, from, next) {
        if (this.changed) {
            this.$root.dialog({
                type: 'warning',
                text: this.$t('leave-confirm'),
                showCancelButton: true
            }).then(({ canceled }) => {
                if (canceled) {
                    next(false);
                }
                else {
                    next();
                }
            });
        }
        else {
            next();
        }
    },
    beforeDestroy() {
        room.destroy();
        window.removeEventListener('beforeunload', this.beforeunload);
    },
    methods: {
        beforeunload(e) {
            if (this.changed) {
                e.preventDefault();
                e.returnValue = '';
            }
        },
        async add() {
            const { canceled, result: id } = await this.$root.dialog({
                type: null,
                title: this.$t('add-furniture'),
                select: {
                    items: storeItems.map(item => ({
                        value: item.id, text: this.$t('furnitures.' + item.id)
                    }))
                },
                showCancelButton: true
            });
            if (canceled)
                return;
            room.addFurniture(id);
            this.changed = true;
        },
        remove() {
            this.isTranslateMode = false;
            this.isRotateMode = false;
            room.removeFurniture();
            this.changed = true;
        },
        save() {
            this.$root.api('room/update', {
                room: room.getRoomInfo()
            }).then(() => {
                this.changed = false;
                this.$root.dialog({
                    type: 'success',
                    text: this.$t('saved')
                });
            }).catch((e) => {
                this.$root.dialog({
                    type: 'error',
                    text: e.message
                });
            });
        },
        clear() {
            this.$root.dialog({
                type: 'warning',
                text: this.$t('clear-confirm'),
                showCancelButton: true
            }).then(({ canceled }) => {
                if (canceled)
                    return;
                room.removeAllFurnitures();
                this.changed = true;
            });
        },
        chooseImage(key) {
            this.$chooseDriveFile({
                multiple: false
            }).then(file => {
                room.updateProp(key, `/proxy/?${Object(url["query"])({ url: file.thumbnailUrl })}`);
                this.$refs.preview.selected(room.getSelectedObject());
                this.changed = true;
            });
        },
        updateColor(key, ev) {
            room.updateProp(key, ev.target.value);
            this.$refs.preview.selected(room.getSelectedObject());
            this.changed = true;
        },
        updateCarpetColor(ev) {
            room.updateCarpetColor(ev.target.value);
            this.carpetColor = ev.target.value;
            this.changed = true;
        },
        updateRoomType(type) {
            room.changeRoomType(type);
            this.roomType = type;
            this.changed = true;
        },
        translate() {
            if (this.isTranslateMode) {
                this.exit();
            }
            else {
                this.isRotateMode = false;
                this.isTranslateMode = true;
                room.enterTransformMode('translate');
            }
            this.changed = true;
        },
        rotate() {
            if (this.isRotateMode) {
                this.exit();
            }
            else {
                this.isTranslateMode = false;
                this.isRotateMode = true;
                room.enterTransformMode('rotate');
            }
            this.changed = true;
        },
        exit() {
            this.isTranslateMode = false;
            this.isRotateMode = false;
            room.exitTransformMode();
            this.changed = true;
        }
    }
}));

// CONCATENATED MODULE: ./src/client/app/common/views/pages/room/room.vue?vue&type=script&lang=ts&
 /* harmony default export */ var room_roomvue_type_script_lang_ts_ = (roomvue_type_script_lang_ts_); 
// EXTERNAL MODULE: ./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&
var roomvue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true_ = __webpack_require__("./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&");

// CONCATENATED MODULE: ./src/client/app/common/views/pages/room/room.vue






/* normalize component */

var room_component = Object(componentNormalizer["default"])(
  room_roomvue_type_script_lang_ts_,
  roomvue_type_template_id_78de78e8_scoped_true_render,
  staticRenderFns,
  false,
  null,
  "78de78e8",
  null
  
)

/* hot reload */
if (false) { var room_api; }
room_component.options.__file = "src/client/app/common/views/pages/room/room.vue"
/* harmony default export */ var room_room = __webpack_exports__["default"] = (room_component.exports);

/***/ }),

/***/ "./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&":
/*!*********************************************************************************************************************!*\
  !*** ./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true& ***!
  \*********************************************************************************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module exports are unknown */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_vue_style_loader_index_js_node_modules_css_loader_dist_cjs_js_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_1_oneOf_1_2_node_modules_stylus_loader_index_js_node_modules_vue_loader_lib_index_js_vue_loader_options_node_modules_vue_svg_inline_loader_dist_index_min_js_room_vue_vue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../node_modules/vue-style-loader!../../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../node_modules/postcss-loader/src??ref--1-oneOf-1-2!../../../../../../../node_modules/stylus-loader!../../../../../../../node_modules/vue-loader/lib??vue-loader-options!../../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true& */ "./node_modules/vue-style-loader/index.js!./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/stylus-loader/index.js!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-svg-inline-loader/dist/index.min.js!./src/client/app/common/views/pages/room/room.vue?vue&type=style&index=0&id=78de78e8&lang=stylus&scoped=true&");
/* harmony import */ var _node_modules_vue_style_loader_index_js_node_modules_css_loader_dist_cjs_js_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_1_oneOf_1_2_node_modules_stylus_loader_index_js_node_modules_vue_loader_lib_index_js_vue_loader_options_node_modules_vue_svg_inline_loader_dist_index_min_js_room_vue_vue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_vue_style_loader_index_js_node_modules_css_loader_dist_cjs_js_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_1_oneOf_1_2_node_modules_stylus_loader_index_js_node_modules_vue_loader_lib_index_js_vue_loader_options_node_modules_vue_svg_inline_loader_dist_index_min_js_room_vue_vue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _node_modules_vue_style_loader_index_js_node_modules_css_loader_dist_cjs_js_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_1_oneOf_1_2_node_modules_stylus_loader_index_js_node_modules_vue_loader_lib_index_js_vue_loader_options_node_modules_vue_svg_inline_loader_dist_index_min_js_room_vue_vue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _node_modules_vue_style_loader_index_js_node_modules_css_loader_dist_cjs_js_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_1_oneOf_1_2_node_modules_stylus_loader_index_js_node_modules_vue_loader_lib_index_js_vue_loader_options_node_modules_vue_svg_inline_loader_dist_index_min_js_room_vue_vue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_node_modules_vue_style_loader_index_js_node_modules_css_loader_dist_cjs_js_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_1_oneOf_1_2_node_modules_stylus_loader_index_js_node_modules_vue_loader_lib_index_js_vue_loader_options_node_modules_vue_svg_inline_loader_dist_index_min_js_room_vue_vue_type_style_index_0_id_78de78e8_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ })

}]);
//# sourceMappingURL=38.11.37.1.js.map